# slice2solid

**slice2solid** — инженерно-ориентированный инструмент для восстановления цифрового представления
FDM-деталей по данным слайсинга **Stratasys Insight**.
Основная цель — обеспечить корректный **прочностной анализ (CAE/ANSYS)** с учётом траекторий печати,
а также (опционально) выполнить **явную геометрическую реконструкцию** внутренней структуры (инфилла/периметров) в виде mesh.

Программный продукт разработан в рамках выполнения НИР «Проектирование и получение ауксетиков, обладающих проводимостью»
в рамках задания «Электромагнитные свойства ауксетиков, полученных методом 3D печати».

Проект закрывает разрыв между:
- геометрией в САПР (CAD),
- «производственным намерением» слайсера (траектории, инфилл, периметры),
- и конечно-элементным анализом (CAE/ANSYS).

---

## Скачать и установить (Windows)

1) Откройте страницу релизов: [Releases](../../releases/latest)
2) В разделе Assets скачайте `slice2solid-setup.exe`
3) Запустите установщик (если Windows SmartScreen ругается — нажмите “More info” → “Run anyway”)

Если в релизах ещё нет готового установщика, соберите его из исходников по инструкции `docs/installer_ru.md`.

---

## Контекст проекта (Project Background)

Проект разработан в рамках исследовательской работы, связанной с ауксетическими и решётчатыми (lattice)
структурами, изготавливаемыми промышленной FDM‑печатью.

Промышленные принтеры Stratasys широко используются в лабораториях и на предприятиях, однако
проприетарный слайсер **Stratasys Insight** не предоставляет средств для восстановления фактической внутренней геометрии
(инфилл, периметры, траектории), необходимой для последующего инженерного анализа.

---

## Постановка проблемы (Problem Statement)

После слайсинга в Stratasys Insight:
- фактическая внутренняя структура детали теряется для CAD/CAE‑систем;
- невозможно выполнить корректный FEM‑анализ с учётом геометрии инфилла;
- анизотропия, присущая FDM‑печати, не может быть адекватно учтена;
- восстановленная геометрия не переиспользуется в CAD‑сборках.

Стандартные CAD/CAE‑инструменты не решают эту задачу напрямую.

---

## Решение: что делает slice2solid (Solution)

slice2solid восстанавливает представление FDM‑детали **после** слайсинга в Stratasys Insight на основе экспортов слайсера.
Инструмент поддерживает два режима, использующих одни и те же входные данные:

### 1) CAE‑представление (основной режим)
- гладкая замкнутая геометрия по `placed STL`;
- учёт структуры печати через анизотропные свойства и ориентации по траекториям;
- экспорт данных ориентаций/слоёв для ANSYS Mechanical.

### 2) Геометрическая реконструкция (опционально)
- явная реконструкция инфилла/периметров в виде mesh на основе траекторий;
- подходит для визуализации, оценки массы/инерции и последующей конвертации во внешних CAD/mesh‑инструментах.

---

## Промышленная значимость (Industrial Relevance)

Stratasys‑принтеры активно используются в промышленности и университетах, при этом инженерным подразделениям часто
не хватает инструмента, позволяющего выполнить корректный пост‑процессинг и анализ деталей со сложной внутренней структурой.

slice2solid позволяет:
- готовить данные для механических расчётов с учётом структуры печати;
- оценивать массу/жёсткость с учётом траекторий/заполнения;
- переиспользовать результат в CAD‑сборках (через mesh‑представление и внешнюю конвертацию).

---

## Связь с исследовательской работой (Relation to Research Work)

ПО разработано как часть исследовательской деятельности, связанной с ауксетическими и решётчатыми структурами,
изготавливаемыми аддитивными технологиями.
Инструмент служит инфраструктурным решением, позволяющим проводить дальнейшие исследования механических и функциональных свойств
печатных структур.

---

## Быстрый старт (Python)

Требования:
- Windows (из-за Stratasys Insight; код проекта — Python);
- Python 3.11+;
- данные из Stratasys Insight: `*-simulation-data.txt` и `placed STL`;
- (опционально) ANSYS Mechanical для импорта ориентаций/слоёв.

Установка (из корня репозитория):
- `python -m venv .venv`
- `.\.venv\Scripts\Activate.ps1`
- `pip install -r requirements.txt`

Запуск GUI (основной режим):
- `python run_gui.py`

Если процесс GUI стартует, но окно не видно (например, после отключения второго монитора):
- `python run_gui.py --reset-ui`

CLI‑утилита (на данный момент — standalone Mesh Healer):
- `python run_cli.py heal data/samples/smoke_preview_structure.stl --heal-preset safe --close-holes-max 2.0 --report heal_report.json`

---

## Типовой рабочий процесс (Typical Workflow)

1. Спроектировать монолитное тело в CAD
2. Экспортировать STL из CAD
3. Импортировать STL в Stratasys Insight
4. Ориентировать деталь и сохранить `placed STL`
5. Выполнить slicing
6. Экспортировать симуляцию траекторий: `*-simulation-data.txt`
7. Запустить `slice2solid` для получения:
   - CAE‑ориентированного представления и ориентаций траекторий
   - (опционально) mesh‑геометрии внутренней структуры
8. Выполнить расчёт в ANSYS

---

## Входные данные (Inputs)

Минимально необходимо:
- текстовый экспорт симуляции траекторий из Insight: `*-simulation-data.txt` (с блоком заголовка `Toolpath Simulation Data`, матрицей `STL to CMB transformation matrix` и таблицей траекторий);
- `placed STL` из Insight (эталонная геометрия для габаритов/сопоставления координат и предпросмотра/экспорта).

Опционально (рекомендуется для авто‑параметров/метаданных):
- папка задания Insight `ssys_*` с `sliceParams.*`, `toolpathParams.*`, `supportParams.*` и др.

Примечания:
- заголовок Simulation Data используется для `Slice height`, shrink factors, проверок матрицы и др.;
- учтена локаль: в экспортируемых числах может встречаться запятая как десятичный разделитель.

---

## Выходные данные (Outputs)

Основные выходные файлы (в выбранной папке результата):
- `*_s2s_preview_structure.stl` — mesh‑результат пайплайна (предпросмотр/экспорт структуры);
- `*_s2s_preview_structure_healed.stl` — (опционально) «вылеченная» сетка для импорта в CAD как mesh;
- `*_s2s_preview_structure_healed_report.json` — (опционально) отчёт до/после по сетке;
- `*_s2s_preview_structure_mesh.ply`, `voxel_points.csv`, `cad_import_notes.txt` — (опционально) CAD bundle для внешних инструментов;
- `ansys_layers.json`, `ansys_layers.csv`, `ansys_mechanical_import_layers.py` — (опционально) экспорт для ANSYS Mechanical;
- `metadata.json` — метаданные запуска (параметры, матрицы, оценки размеров/сеток и т.п.).

---

## Структура репозитория

```text
slice2solid/
  TECHNICAL_SPECIFICATION.md        # Техническая спецификация (EN)
  TECHNICAL_SPECIFICATION_RU.md     # Техническая спецификация (RU)
  README.md                         # Описание проекта и запуск
  requirements.txt
  src/                              # Исходный код
  data/                             # Примеры вход/выход
  tests/                            # Тесты/валидация
  docs/                             # Руководства (RU)
  tools/                            # Скрипты сборки/утилиты
```

---

## Mesh Healer (CAD‑импорт сеток)

slice2solid умеет выполнять «лечение» сетки после экспорта STL, создавая `*_healed.stl`.
Цель — повысить вероятность успешного импорта в CAD‑системы, которые поддерживают mesh‑тела (по возможности делая сетку более «watertight/manifold»),
избегая ремешинга/упрощения, способного разрушить детали инфилла.

### GUI (рекомендуется)

- Вкладка `CAD / Геометрия` → блок `Mesh Healer (CAD)`
- Профиль: `safe` (по умолчанию) или `aggressive`
- Опционально можно включить JSON‑отчёт со статистикой до/после рядом с выходным STL

Выходные файлы в папке результата:
- `*_s2s_preview_structure.stl` (исходный)
- `*_s2s_preview_structure_healed.stl` (исправленный)
- `*_s2s_preview_structure_healed_report.json` (опционально)

### CLI (standalone heal)

- `python run_cli.py heal data/samples/smoke_preview_structure.stl --heal-preset safe --close-holes-max 2.0 --report heal_report.json`

### Примечания по backend

- основной backend: `pymeshlab`
- fallback: `meshlabserver` (MeshLab CLI), пример шаблона фильтра: `tools/meshlab/heal_safe_template.mlx`

---

## Документация

- `TECHNICAL_SPECIFICATION_RU.md` — полное описание пайплайна, входов/выходов, преобразований координат и ограничений
- `TECHNICAL_SPECIFICATION.md` — версия на английском
- `docs/cad_import_guide_ru.md` — заметки по импорту mesh в CAD
- `docs/installer_ru.md` — сборка установщика для Windows

---

## Допущения и ограничения

- пористость учитывается через эффективные свойства;
- термические остаточные напряжения не моделируются;
- материал внутри локальных областей считается однородным.

---

## Дальнейшая работа (Future Work)

- поддержка дополнительных слайсеров;
- экспорт в CAE‑готовые форматы и улучшение связки с Mechanical;
- автоматизированное построение карт анизотропии для FEM;
- межслойные когезионные модели и прогрессирующее разрушение;
- учёт остаточных напряжений и многоматериальной печати.

---

## Проверка (smoke)

- `python -m unittest discover -s tests -p "test_*.py"`
